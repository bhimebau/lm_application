<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>uEACos: timer.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>timer.c File Reference</h1><code>#include &lt;msp430x16x.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;signal.h&gt;</code><br>
<code>#include &quot;<a class="el" href="ueaclib_8h-source.html">ueaclib.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="ueac_8h-source.html">ueac.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="conversion_8h-source.html">conversion.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="filter_8h-source.html">filter.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="global_8h-source.html">global.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="lla_8h-source.html">lla.h</a>&quot;</code><br>

<p>
Include dependency graph for timer.c:<p><center><img src="timer_8c__incl.png" border="0" usemap="#timer.c_map" alt=""></center>
<map name="timer.c_map">
<area href="ueaclib_8h.html" shape="rect" coords="134,210,209,237" alt="">
<area href="ueac_8h.html" shape="rect" coords="141,261,202,288" alt="">
<area href="conversion_8h.html" shape="rect" coords="124,312,220,338" alt="">
<area href="filter_8h.html" shape="rect" coords="144,362,200,389" alt="">
<area href="global_8h.html" shape="rect" coords="137,413,206,440" alt="">
<area href="lla_8h.html" shape="rect" coords="149,464,194,490" alt="">
</map>

<p>
<a href="timer_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#a0">timer_a0_irq</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#a1">delay_1_25mS</a> (int count)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1"></a><!-- doxytag: member="timer.c::delay_1_25mS" ref="a1" args="(int count)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void delay_1_25mS           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>count</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="timer_8c-source.html#l00116">116</a> of file <a class="el" href="timer_8c-source.html">timer.c</a>.
<p>
References <a class="el" href="global_8c-source.html#l00058">timer_tick</a>.
<p>
Referenced by <a class="el" href="calibrate_8c-source.html#l00111">current_output_calibration()</a>, <a class="el" href="main_8c-source.html#l00088">main()</a>, <a class="el" href="main_8c-source.html#l00151">print_grid_i()</a>, <a class="el" href="calibrate_8c-source.html#l00061">scan_leds()</a>, and <a class="el" href="main_8c-source.html#l00113">scan_probes()</a>.<div class="fragment"><pre class="fragment"><a name="l00116"></a>00116                              {
<a name="l00117"></a>00117   <span class="keywordtype">int</span> tick_counter=0;
<a name="l00118"></a>00118   <span class="keywordflow">while</span> (tick_counter&lt;count) {
<a name="l00119"></a>00119     <span class="keywordflow">if</span> (<a class="code" href="global_8c.html#a5">timer_tick</a>) {
<a name="l00120"></a>00120       tick_counter++;
<a name="l00121"></a>00121       timer_tick=0;
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123   }
<a name="l00124"></a>00124 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a0"></a><!-- doxytag: member="timer.c::timer_a0_irq" ref="a0" args="()" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">timer_a0_irq           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Timer A1 Interupt Handler<p>
Timer A is used as the time base for the scheduler. This interrupt occurs every 1.25mS.
<p>
Definition at line <a class="el" href="timer_8c-source.html#l00066">66</a> of file <a class="el" href="timer_8c-source.html">timer.c</a>.
<p>
References <a class="el" href="lla_8c-source.html#l00134">evaluate_lla()</a>, <a class="el" href="global_8c-source.html#l00060">high_time_limit</a>, <a class="el" href="ueaclib_8c-source.html#l00441">led_pwm()</a>, <a class="el" href="global_8c-source.html#l00059">led_screen_enable</a>, <a class="el" href="ueac_8c-source.html#l00225">lla_input_check()</a>, <a class="el" href="global_8c-source.html#l00056">pin_data</a>, <a class="el" href="ueaclib_8c-source.html#l00363">start_a2d_converter()</a>, <a class="el" href="global_8c-source.html#l00058">timer_tick</a>, <a class="el" href="global_8c-source.html#l00054">ueac_state</a>, <a class="el" href="filter_8c-source.html#l00049">update_a2d_data()</a>, and <a class="el" href="ueaclib_8c-source.html#l00377">write_analog_mux()</a>.<div class="fragment"><pre class="fragment"><a name="l00066"></a>00066                {
<a name="l00067"></a>00067   <span class="keyword">static</span> <span class="keywordtype">int</span> chan_last=0;
<a name="l00068"></a>00068   <span class="keyword">static</span> <span class="keywordtype">int</span> chan_next=0;
<a name="l00069"></a>00069   <span class="keyword">static</span> <span class="keywordtype">char</span> state=0;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071   TACCR0+=0x900;               <span class="comment">// Increment the compare register for 2305 ticks into future (625uS)</span>
<a name="l00072"></a>00072   <span class="keywordflow">if</span> (!state) {                <span class="comment">// evaluate the system every 1.25mS </span>
<a name="l00073"></a>00073     chan_last=chan_next&amp;0x07;
<a name="l00074"></a>00074     <a class="code" href="ueaclib_8c.html#a19">write_analog_mux</a>(++chan_next);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     <a class="code" href="filter_8c.html#a0">update_a2d_data</a>(&amp;<a class="code" href="global_8c.html#a3">pin_data</a>[chan_last],ADC12MEM0);
<a name="l00077"></a>00077     <a class="code" href="filter_8c.html#a0">update_a2d_data</a>(&amp;<a class="code" href="global_8c.html#a3">pin_data</a>[8+chan_last],ADC12MEM1);
<a name="l00078"></a>00078     <a class="code" href="filter_8c.html#a0">update_a2d_data</a>(&amp;<a class="code" href="global_8c.html#a3">pin_data</a>[16+chan_last],ADC12MEM2);
<a name="l00079"></a>00079     <span class="keywordflow">if</span> (chan_last==0) {
<a name="l00080"></a>00080       <a class="code" href="filter_8c.html#a0">update_a2d_data</a>(&amp;<a class="code" href="global_8c.html#a3">pin_data</a>[24],ADC12MEM3);
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     <span class="keywordflow">if</span> (<a class="code" href="ueac_8c.html#a1">lla_input_check</a>(chan_last,&amp;<a class="code" href="global_8c.html#a1">ueac_state</a>)) {
<a name="l00084"></a>00084       <a class="code" href="global_8c.html#a7">high_time_limit</a>[chan_last]=1;
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086     <span class="keywordflow">else</span> {
<a name="l00087"></a>00087       <a class="code" href="global_8c.html#a7">high_time_limit</a>[chan_last]=ADC12MEM0&gt;&gt;8;
<a name="l00088"></a>00088     }
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (<a class="code" href="ueac_8c.html#a1">lla_input_check</a>(8+chan_last,&amp;<a class="code" href="global_8c.html#a1">ueac_state</a>)) {
<a name="l00090"></a>00090       <a class="code" href="global_8c.html#a7">high_time_limit</a>[8+chan_last]=1;
<a name="l00091"></a>00091     }
<a name="l00092"></a>00092     <span class="keywordflow">else</span> {
<a name="l00093"></a>00093       <a class="code" href="global_8c.html#a7">high_time_limit</a>[8+chan_last]=ADC12MEM1&gt;&gt;8;
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095     <span class="keywordflow">if</span> (<a class="code" href="ueac_8c.html#a1">lla_input_check</a>(16+chan_last,&amp;<a class="code" href="global_8c.html#a1">ueac_state</a>)) {
<a name="l00096"></a>00096       <a class="code" href="global_8c.html#a7">high_time_limit</a>[16+chan_last]=1;
<a name="l00097"></a>00097     }
<a name="l00098"></a>00098     <span class="keywordflow">else</span> {
<a name="l00099"></a>00099       <a class="code" href="global_8c.html#a7">high_time_limit</a>[16+chan_last]=ADC12MEM2&gt;&gt;8;
<a name="l00100"></a>00100     }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="keywordflow">if</span> (<a class="code" href="ueac_8c.html#a1">lla_input_check</a>(24,&amp;<a class="code" href="global_8c.html#a1">ueac_state</a>)) {
<a name="l00103"></a>00103       <a class="code" href="global_8c.html#a7">high_time_limit</a>[24]=2;
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105     <span class="keywordflow">else</span> {
<a name="l00106"></a>00106       <a class="code" href="global_8c.html#a7">high_time_limit</a>[24]=(ADC12MEM3&gt;&gt;8)+1;
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108     <a class="code" href="lla_8c.html#a9">evaluate_lla</a>(&amp;<a class="code" href="global_8c.html#a1">ueac_state</a>);
<a name="l00109"></a>00109     <a class="code" href="ueaclib_8c.html#a9">start_a2d_converter</a>();
<a name="l00110"></a>00110     <a class="code" href="global_8c.html#a5">timer_tick</a>=1;
<a name="l00111"></a>00111   }
<a name="l00112"></a>00112   state^=1;
<a name="l00113"></a>00113   <a class="code" href="ueaclib_8c.html#a22">led_pwm</a>(<a class="code" href="global_8c.html#a6">led_screen_enable</a>);
<a name="l00114"></a>00114 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="timer_8c_a0_cgraph.png" border="0" usemap="#timer_8c_a0_cgraph_map" alt=""></center>
<map name="timer_8c_a0_cgraph_map">
<area href="lla_8c.html#a9" shape="rect" coords="177,33,268,59" alt="">
<area href="ueaclib_8c.html#a22" shape="rect" coords="185,83,260,110" alt="">
<area href="ueac_8c.html#a1" shape="rect" coords="166,134,278,161" alt="">
<area href="ueaclib_8c.html#a9" shape="rect" coords="152,185,293,211" alt="">
<area href="filter_8c.html#a0" shape="rect" coords="160,235,285,262" alt="">
<area href="ueaclib_8c.html#a19" shape="rect" coords="157,286,288,313" alt="">
<area href="conversion_8c.html#a0" shape="rect" coords="345,7,438,34" alt="">
<area href="ueaclib_8c.html#a20" shape="rect" coords="342,58,441,85" alt="">
<area href="ueaclib_8c.html#a21" shape="rect" coords="490,58,570,85" alt="">
<area href="external__flash_8h.html#a5" shape="rect" coords="620,58,726,85" alt="">
</map>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu Apr 20 13:57:17 2006 for uEACos by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
